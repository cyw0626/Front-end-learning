# [Cache策略](https://www.jianshu.com/p/19b6a00ad3a8)  
## 作用  
- 减少网络带宽的压力  
- 降低服务器压力  
- 减少网络延迟，加快页面打开速度
## 浏览器缓存   
- Http协议头:新鲜度  
过期机制：HTTP协议报头含有完整的过期时间头信息，并且在有效期内/浏览器已经使用过这个缓存副本，并且在一个会话中以已经检查过新鲜度   
- HTML页面的meta标签：校验值  
服务器返回资源的时候有时在控制头信息带上这个资源的实体标签Entity tag,它可以用来作为浏览器再次请求过程中的校验标志   
规定浏览器是否可以直接使用缓存中的副本，还是需要从原服务器中获取更新的版本。   
### HTTP缓存机制   
本地缓存->协商缓存304->缓存失败200/404  
#### 强制缓存   
- 不存在缓存结果和标志，缓存失效，直接向服务器请求   
- 存在缓存结果和缓存标志，结果失效，缓存失败，协商缓存   
- 存在该缓存结果和缓存标值，结果尚未失效，强制缓存生效，直接返回该结果   
控制强制缓存字段：Cache-Control>Expires   
##### Expires  
Expires是Http1.0控制网页缓存的字段，其值为服务器返回该请求结果缓存的到期时间  
##### Cache-Control  
HTTP1.1加入，控制网页缓存   
- public：所有将被缓存  
- private:默认值，所有内容只有客户端可以缓存   
- no-cache:客户端缓存，是否使用缓存规则需要经过协商缓存来验证  
- no-store：所有内容都不会被缓存  
- max-age=...:缓存内容将在xxx秒失效   
###### 缓存位置  
js/img存入内存；css存入硬盘   
#### 协商缓存   
- 304数据未更改可以继续使用  
- 200数据已发生更改，返回客户端新的数据   
##### Last-Modified/If-Modified-Since   
##### Etag/If-None-Match  
##### Etag/LastModified过程   
- 客户端请求一个页面A  
- 服务器返回页面A，并将页面连同Last-Modified/Etag   
- 客户端展现该页面，连同Last-Modified/Etag一起缓存   
- 客户端再次请求页面A，并将上次请求的服务器返回的Last-Modified/Etag一起传递给服务器   
- 服务器检查Last-modified或者Etag，判断304,返回一个空的响应体   
##### Content-Length/Vary   
## 服务端缓存  
### CDN缓存   
CDN缓存：网关缓存/反向代理缓存。浏览器先向CDN网关发起web请求，网关服务器后面对应着一台或者堕胎负载均衡服务器，会根据他们的负载请求，动态地请求转发到合适的源服务器上。  
### Combo服务  
Combo服务，最终拼接生成页面资源的时候，将资源地址拼接成一个url路径，线上动态资源合并服务，减少Http请求的需求。  
## HTML5缓存  
### html5离线应用缓存manifest   
- 用户可离线访问应用  
- 用户访问本地的缓存文件  
- 仅仅加载被修改过的资源   
### localStorage  
自定义的客户端缓存   
## 建议   
- 同一个资源保证URL的稳定性  
- 给CSS，JS，图片等资源增加Http缓存头，并强制入口HTML不被缓存  
- 减少对cookie的依赖  
- 减少对HTTPs加密协议的使用  
- 多用GET方式请求动态Cgi  
- 动态Cgi也可以被缓存   




